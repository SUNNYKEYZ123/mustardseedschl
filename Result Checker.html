<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="https://sunnykeyz123.github.io/mustardseedschl/images/Logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mustard Seed CBT | Result Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, onSnapshot, query, where, setDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDOO3uHmzOuAxJcdLxu-OImzlH12A6FpeY",
            authDomain: "my-project-a6208.firebaseapp.com",
            projectId: "my-project-a6208",
            storageBucket: "my-project-a6208.firebasestorage.app",
            messagingSenderId: "784486701962",
            appId: "1:784486701962:web:0d3cd002bbfd647e944673"
        };

        const app = initializeApp(firebaseConfig);
        window.fb = {
            db: getFirestore(app),
            auth: getAuth(app),
            collection, addDoc, getDocs, doc, deleteDoc, onSnapshot, query, where, signInAnonymously, onAuthStateChanged, setDoc, writeBatch
        };
    </script>

    <script type="text/babel">
        const AppContext = React.createContext(null);

        // --- NEW RESULT CHECKER PAGE COMPONENT ---
        const ResultCheckerPage = () => {
            const { setPage } = React.useContext(AppContext);
            const [msId, setMsId] = React.useState('');
            const [result, setResult] = React.useState(null);
            const [loading, setLoading] = React.useState(false);

            const handleCheck = async () => {
                if(!msId) return alert("Please enter your ID");
                setLoading(true);
                const inputId = msId.toUpperCase().trim();
                
                try {
                    // Logic: Search the scores collection for the specific Student ID
                    const q = fb.query(
                        fb.collection(fb.db, "artifacts/my-project-a6208/scores"), 
                        fb.where("studentId", "==", inputId)
                    );
                    const snap = await fb.getDocs(q);
                    
                    if (!snap.empty) {
                        setResult(snap.docs[0].data());
                    } else {
                        alert("No result found. Did you complete the exam?");
                    }
                } catch (e) { alert(e.message); }
                setLoading(false);
            };

            return (
                <div className="flex flex-col items-center justify-center min-h-screen p-6">
                    <div className="bg-white p-8 rounded-3xl shadow-2xl border w-full max-w-md">
                        <button onClick={() => setPage('home')} className="text-gray-400 text-xs mb-4 uppercase font-bold tracking-widest hover:text-blue-600 transition">‚Üê Back to Home</button>
                        <h1 className="text-3xl font-black mb-2">Check Result</h1>
                        <p className="text-gray-500 mb-6 text-sm">Enter your MS-ID to see your score.</p>
                        
                        <input className="w-full p-4 border rounded-xl mb-4 uppercase focus:ring-2 focus:ring-blue-500 outline-none" placeholder="MS-XXXXX" onChange={e => setMsId(e.target.value)} />
                        <button onClick={handleCheck} className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition">
                            {loading ? "Searching..." : "View My Score"}
                        </button>

                        {result && (
                            <div className="mt-8 bg-blue-50 p-6 rounded-2xl border border-blue-100 text-center">
                                <p className="text-[10px] font-black text-blue-400 uppercase">Candidate Name</p>
                                <h3 className="text-xl font-black text-slate-800 mb-4">{result.studentName}</h3>
                                <div className="text-5xl font-black text-blue-600 mb-2">{result.score}%</div>
                                <p className="text-sm font-bold text-slate-500">{result.correctAnswers} Correct out of {result.totalQuestions}</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- MAIN APP WITH UPDATED NAVIGATION ---
        const App = () => {
            const [page, setPage] = React.useState('home');
            const [ready, setReady] = React.useState(false);

            React.useEffect(() => {
                const i = setInterval(() => { if(window.fb) { setReady(true); clearInterval(i); }}, 100);
            }, []);

            if (!ready) return <div className="p-20 text-center font-black">CONNECTING DATABASE...</div>;

            return (
                <AppContext.Provider value={{ setPage }}>
                    {page === 'home' && (
                        <div className="flex flex-col items-center justify-center min-h-screen text-center">
                            <h1 className="text-5xl font-black mb-10 tracking-tighter">MUSTARD SEED CBT</h1>
                            <div className="flex flex-col space-y-4">
                                <button onClick={() => setPage('exam')} className="bg-blue-600 text-white px-12 py-4 rounded-full font-bold shadow-lg hover:bg-blue-700 transition">TAKE EXAM</button>
                                
                                {/* Link for the Result Checker */}
                                <button onClick={() => setPage('results')} className="text-blue-600 font-bold hover:underline">Check My Result</button>
                                
                                <button onClick={() => setPage('admin')} className="text-gray-400 text-xs mt-10 hover:text-black">ADMIN ACCESS</button>
                            </div>
                        </div>
                    )}

                    {/* Navigation Logic */}
                    {page === 'exam' && <StudentExamPage />} 
                    {page === 'results' && <ResultCheckerPage />}
                    {page === 'admin' && <AdminPage />} 
                </AppContext.Provider>
            );
        };

        // Note: You will need to include the AdminPage and StudentExamPage code from your original file here to make it complete.
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>